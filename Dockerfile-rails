FROM ruby:2.7.0

RUN curl -sL https://deb.nodesource.com/setup_9.x | bash -
RUN apt-get update -qq && apt-get install -y build-essential libpq-dev postgresql-client nodejs
RUN npm install -g yarn n

# To install the specific version of Node.js
RUN n 11.14.0
RUN apt purge -y nodejs && apt autoremove -y

ADD . /app
WORKDIR /app

RUN bundle install
RUN yarn
RUN yarn dev-build