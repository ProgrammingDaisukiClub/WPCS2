box: ruby:2.4.0

services:
  - postgres

build:
  steps:
    - bigtruedata/install-node:
      version: 7.5.0

    - npm-install

    - bundle-install

    - rails-database-yml:
      service: postgresql-docker

    - script:
        name: echo ruby information
        code: |
            echo "ruby version $(ruby --version) running"
            echo "from location $(which ruby)"
            echo -p "gem list: $(gem list)"

    - script:
        name: Set up db
        code: RAILS_ENV=test bundle exec rake db:schema:load

    - script:
        name: Run minitest
        code: bundle exec rake test

    - script:
        name: Run lint
        code: npm run lint
